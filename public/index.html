<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Tele Tech AI</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body { font-family: Arial; background:#f4f6f9; }
.box { max-width:600px; margin:20px auto; background:#fff; padding:15px; border-radius:8px; }
#chat { min-height:250px; border:1px solid #ccc; padding:10px; margin-bottom:10px; overflow-y:auto; }
.msg { margin-bottom:6px; }
.user { color:#007bff; }
.ai { color:#000; }
img { max-width:100%; margin-top:10px; border-radius:8px; }
</style>
</head>

<body>
<div class="box">
  <h2>Tele Tech AI</h2>

  <div id="chat"></div>

  <input id="msg" placeholder="Rubuta sakonka..." style="width:75%">
  <button id="sendBtn">Send</button>

  <hr>

  <h3>ðŸŽ¨ AI Image Generator (PRO)</h3>
  <input id="imagePrompt" placeholder="Rubuta abinda kake so a hoto..." style="width:75%">
  <button id="imgBtn">Generate</button>
  <img id="resultImg" style="display:none">

  <hr>

  <button id="upgradeBtn">Upgrade to Pro ðŸš€</button>

  <p style="text-align:center;margin-top:10px">
    <a href="https://chat.whatsapp.com/G4tqlP1R8rFEUQ03BHviuD" target="_blank">
      ðŸ‘‰ Join WhatsApp Group
    </a>
  </p>
</div>
  
<script>
/* ===== ELEMENTS ===== */
const chat = document.getElementById("chat");
const input = document.getElementById("msg");
const sendBtn = document.getElementById("sendBtn");
const upgradeBtn = document.getElementById("upgradeBtn");
const imgBtn = document.getElementById("imgBtn");
const imagePrompt = document.getElementById("imagePrompt");
const resultImg = document.getElementById("resultImg");

/* ===== SEND CHAT ===== */
sendBtn.onclick = async () => {
  const text = input.value.trim();
  if (!text) return;

  let email = localStorage.getItem("email");
  if (!email) {
    email = prompt("Shigar da email dinka:");
    if (!email) return;
    localStorage.setItem("email", email);
  }

  chat.innerHTML += `<div><b>You:</b> ${text}</div>`;
  input.value = "";

  try {
    const res = await fetch("/chat", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ message: text, email })
    });

    const data = await res.json();
    chat.innerHTML += `<div><b>AI:</b> ${data.reply}</div>`;
  } catch {
    alert("Chat error");
  }
};

/* ===== IMAGE GENERATOR (PRO) ===== */
imgBtn.onclick = async () => {
  const promptText = imagePrompt.value.trim();
  if (!promptText) {
    alert("Rubuta abinda kake so a hoto");
    return;
  }

  let email = localStorage.getItem("email");
  if (!email) {
    email = prompt("Shigar da email dinka:");
    if (!email) return;
    localStorage.setItem("email", email);
  }

  imgBtn.disabled = true;
  imgBtn.innerText = "Generating...";

  try {
    const res = await fetch("/generate-image", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ prompt: promptText, email })
    });

    const data = await res.json();

    if (data.error) {
      alert(data.error);
    } else {
      resultImg.src = data.image;
      resultImg.style.display = "block";
    }
  } catch {
    alert("Image generation failed");
  }

  imgBtn.disabled = false;
  imgBtn.innerText = "Generate";
};

/* ===== UPGRADE ===== */
upgradeBtn.onclick = async () => {
  let email = localStorage.getItem("email");
  if (!email) {
    email = prompt("Enter your email:");
    if (!email) return;
    localStorage.setItem("email", email);
  }

  try {
    const res = await fetch("/pay", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, amount: 1000 })
    });

    const data = await res.json();
    if (data.link) window.location.href = data.link;
  } catch {
    alert("Payment error");
  }
};
</script>
  
</body>
</html>
