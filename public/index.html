<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Tele Tech AI</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body { font-family: Arial, sans-serif; background:#f4f6f9; }
.box { max-width:600px; margin:30px auto; background:#fff; padding:15px; border-radius:8px; }
#chat { min-height:250px; border:1px solid #ccc; padding:10px; margin-bottom:10px; overflow-y:auto; }
.msg { margin-bottom:6px; }
.user { color:#007bff; }
.ai { color:#000; }
</style>
</head>

<body>
<div class="box">
  <h2>Tele Tech AI</h2>

  <div id="chat"></div>

  <input id="msg" placeholder="Rubuta sakonka..." style="width:75%">
  <button onclick="sendMsg()">Send</button>

  <hr>

  <h3>üé® AI Image Generator (PRO)</h3>
  <input id="imagePrompt" placeholder="Rubuta abinda kake so a hoto..." style="width:75%">
  <button onclick="generateImage()">Generate</button>

  <br><br>
  <img id="resultImg" style="max-width:100%; display:none; border-radius:8px;">

  <hr>

  <button onclick="upgrade()">Upgrade to Pro üöÄ</button>

  <p style="text-align:center;">
    <a href="https://chat.whatsapp.com/G4tqlP1R8rFEUQ03BHviuD" target="_blank">
      üëâ Join WhatsApp Group
    </a>
  </p>
</div>

<script>
const chat = document.getElementById("chat");
const FREE_LIMIT = 10;

let usage = JSON.parse(localStorage.getItem("usage") || '{"count":0}');
let email = localStorage.getItem("email");

/* ===== HELPERS ===== */
function add(role, text) {
  const d = document.createElement("div");
  d.className = "msg " + (role === "You" ? "user" : "ai");
  d.innerHTML = `<b>${role}:</b> ${text}`;
  chat.appendChild(d);
  chat.scrollTop = chat.scrollHeight;
}

function getEmail() {
  if (!email) {
    email = prompt("Shigar da email dinka:");
    if (!email) return null;
    localStorage.setItem("email", email);
  }
  return email;
}

/* ===== CHAT ===== */
async function sendMsg() {
  const text = msg.value.trim();
  if (!text) return;

  const userEmail = getEmail();
  if (!userEmail) return;

  if (usage.count >= FREE_LIMIT) {
    alert("‚ùå Free limit ya cika. Ka upgrade.");
    return;
  }

  add("You", text);
  msg.value = "";

  const res = await fetch("/chat", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ message:text, email:userEmail })
  });

  const data = await res.json();
  add("AI", data.reply);

  if (!data.pro) {
    usage.count++;
    localStorage.setItem("usage", JSON.stringify(usage));
  }
}

/* ===== IMAGE (PRO) ===== */
async function generateImage() {
  const prompt = imagePrompt.value.trim();
  if (!prompt) return;

  const userEmail = getEmail();
  if (!userEmail) return;

  const res = await fetch("/image", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ prompt, email:userEmail })
  });

  const data = await res.json();

  if (!data.url) {
    alert(data.error || "Image error");
    return;
  }

  resultImg.src = data.url;
  resultImg.style.display = "block";
}

/* ===== UPGRADE ===== */
async function upgrade() {
  const userEmail = getEmail();
  if (!userEmail) return;

  const res = await fetch("/pay", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ email:userEmail, amount:1000 })
  });

  const data = await res.json();
  if (data.link) window.location.href = data.link;
}
<script>
const imgBtn = document.getElementById("imgBtn");
const imagePrompt = document.getElementById("imagePrompt");
const resultImg = document.getElementById("resultImg");

imgBtn.addEventListener("click", async () => {
  const promptText = imagePrompt.value.trim();
  if (!promptText) {
    alert("Rubuta abinda kake so a hoto");
    return;
  }

  let email = localStorage.getItem("email");
  if (!email) {
    email = prompt("Shigar da email dinka:");
    if (!email) return;
    localStorage.setItem("email", email);
  }

  imgBtn.disabled = true;
  imgBtn.innerText = "Generating...";

  try {
    const res = await fetch("/generate-image", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ prompt: promptText, email })
    });

    const data = await res.json();

    if (data.error) {
      alert(data.error);
    } else {
      resultImg.src = data.image;
      resultImg.style.display = "block";
    }

  } catch (e) {
    alert("Image generation failed");
  }

  imgBtn.disabled = false;
  imgBtn.innerText = "Generate";
});
</script>
</body>
</html>
