<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Tele Tech AI</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f6f9;
}

.box {
  max-width: 600px;
  margin: 30px auto;
  background: #ffffff;
  padding: 15px;
  border-radius: 8px;
}

#chat {
  min-height: 300px;
  border: 1px solid #ccc;
  padding: 10px;
  margin-bottom: 10px;
  overflow-y: auto;
}

.msg {
  margin-bottom: 6px;
}

.user { color: #007bff; }
.ai { color: #000; }

.delete {
  color: red;
  cursor: pointer;
  margin-left: 6px;
}
</style>
</head>

<body>

<div class="box">
  <h2>Tele Tech AI</h2>

  <div id="chat"></div>

<input id="msg" placeholder="Rubuta sakonka..." style="width:75%">
<button id="sendBtn">Send</button> 
  
<br><br>
<button id="upgradeBtn">Upgrade to Pro ğŸš€</button>
<br>

<p style="font-size:14px; text-align:center;">
  ğŸ“² <b>Join WhatsApp Group</b> for updates & support <br>
  <a 
    href="https://chat.whatsapp.com/G4tqlP1R8rFEUQ03BHviuD" 
    target="_blank"
    style="color:#007bff; font-weight:bold;"
  >
    ğŸ‘‰ Join WhatsApp Group
  </a>
</p>

<hr>

<p style="font-size:14px; text-align:center;">
  ğŸ’³ <b>Pro Upgrade Payment</b><br><br>

  Bank: <b>OPay</b><br>
  Account Name: <b>SUNUSI MUSA</b><br>
  Account Number: <b>7012146832</b><br><br>

  Bayan biya, turo proof a WhatsApp ğŸ‘†
</p>
<script>
/* ===== LIMIT ===== */
const FREE_LIMIT = 10;
let usage = JSON.parse(localStorage.getItem("usage") || "{}");
const today = new Date().toDateString();

if (usage.date !== today) {
  usage = { count: 0, date: today };
  localStorage.setItem("usage", JSON.stringify(usage));
}

/* ===== ELEMENTS ===== */
const chat = document.getElementById("chat");
const input = document.getElementById("msg");
const sendBtn = document.getElementById("sendBtn");

/* ===== LOAD CHAT ===== */
const saved = JSON.parse(localStorage.getItem("chatData") || "[]");
saved.forEach(addToChat);

/* ===== SEND ===== */
sendBtn.addEventListener("click", sendMsg);

async function sendMsg() {
  const text = input.value.trim();
  if (!text) return;

  if (usage.count >= FREE_LIMIT) {
    alert("Free limit reached (10 messages/day)");
    return;
  }

  addAndSave("You", text);
  input.value = "";

  try {
    const res = await fetch("/chat", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ message: text })
    });

    const data = await res.json();
    addAndSave("AI", data.reply || "Error");

    usage.count++;
    localStorage.setItem("usage", JSON.stringify(usage));

  } catch {
    addAndSave("AI", "Server error âŒ");
  }
}

/* ===== HELPERS ===== */
function addAndSave(role, text) {
  const msg = { role, text };
  saveMsg(msg);
  addToChat(msg);
}

function addToChat(msg) {
  const div = document.createElement("div");
  div.className = "msg " + (msg.role === "You" ? "user" : "ai");
  div.innerHTML = `
    <b>${msg.role}:</b> ${msg.text}
    <span class="delete" onclick="deleteMsg(this)">âŒ</span>
  `;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

function saveMsg(msg) {
  const data = JSON.parse(localStorage.getItem("chatData") || "[]");
  data.push(msg);
  localStorage.setItem("chatData", JSON.stringify(data));
}

function deleteMsg(el) {
  const div = el.parentElement;
  div.remove();

  let data = JSON.parse(localStorage.getItem("chatData") || "[]");
  data = data.filter(m => m.text !== div.innerText);
  localStorage.setItem("chatData", JSON.stringify(data));
}

/* ===== UPGRADE BUTTON ===== */
const upgradeBtn = document.getElementById("upgradeBtn");

upgradeBtn.addEventListener("click", () => {
  alert(
    "Upgrade to Pro ğŸš€\n\n" +
    "Pro plan yana nan tafe.\n" +
    "Domin upgrade, tuntubi admin."
  );
});
</script>

</body>
</html>
